{% extends 'base.html' %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


<style>
    /* Background & container */
    html,
    body {
        height: 100%;
        margin: 0;
        background: linear-gradient(135deg, #001A1C 0%, #004E55 100%);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow-y: auto;

        
    }
    .container {
        max-width: 1200px;
     /* Increased top margin for navbar space */
        padding: 20px;
    }



    /* Headings */
    h2 {
        font-weight: 400;
        margin-bottom: 25px;
        font-size: 25px;
    }

    /* Buttons */
    

    /* Tabs */
    .nav-tabs .nav-link {
        color: #004E55;
        border-color: transparent;
        font-weight: 600;
        transition: color 0.3s ease;
    }

    .nav-tabs .nav-link.active {
        color: white;
       background: linear-gradient(to left, #006066, #000f10) !important;
        border-color: #00B8D4 #00B8D4 #004E55;
        font-weight: 700;
        border-radius: 8px 8px 0 0;
    }

    /* .nav-tabs .nav-link:hover {
        color: white;
    } */

    /* Table */
    table.dataTable,
    table.dataTable thead th {
        /* border-color: #00B8D4; */
        color: #E0F7FA;
        /* background-color: #003338; */

    }

    table.dataTable tbody tr {
        /* background-color: #004E55; */
        color: #E0F7FA;
    }

    table.dataTable tbody tr:hover {
        background-color: #006E7B;
    }

    table.dataTable thead th {
        border-bottom: 0px solid #00B8D4;
    }

    /* Badges */
    .badge.bg-success {
        background-color: #00B8D4;
        color: #003338;
        font-weight: 600;
    }

    .badge.bg-danger {
        background-color: #d32f2f;
        color: #fff;
        font-weight: 600;
    }

    /* Modal */
    .modal-content {
        background-color: #003338;
        color: #E0F7FA;
        border-radius: 12px;
        border: none;
    }

    .modal-header {
        border-bottom: 1px solid #00B8D4;
    }

    .modal-title {
        color: white;
        font-weight: 700;
    }

    .form-control,
    .form-select {
        background-color: transparent;
        border: 2px solid #00B8D4;
        color: #E0F7FA;
        border-radius: 8px;
        padding: 8px 12px;
        transition: border-color 0.3s ease;
    }

    .form-control::placeholder {
        color: #4DB6AC;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: #00E5FF;
        box-shadow: 0 0 8px #00E5FFaa;
        background-color: transparent;
        color: #E0F7FA;
    }

    .btn-close {
        filter: invert(1);
    }



   .dataTables_wrapper .dataTables_length,
        .dataTables_wrapper .dataTables_filter {
            margin-bottom: 20px;
        }

        table.dataTable thead th{
            background-color: #008080;
            color: #fff;
        }

        table.dataTable th:first-child {
            border-top-left-radius: 12px;
        }

        table.dataTable th:last-child {
            border-top-right-radius: 12px;
        }

       table.dataTable thead th {
            padding: 30px;
            text-align: center;
        }

        table.dataTable tbody td {
            padding: 10px;
            text-align: center;
        }

    /* Responsive adjustments (optional) */
    @media (max-width: 768px) {

        .dataTables_filter,
        .dataTables_length {
            margin-bottom: 1em;
            display: block;
            width: 100%;
        }

        .dataTables_filter label,
        .dataTables_length label {
            justify-content: space-between;
        }
    }

    :root {
        --bg-gradient: linear-gradient(135deg, #001A1C 0%, #004E55 100%);
        --container-bg: #1a1a1a;
        --primary-color: #00B8D4;
        --primary-color-hover: #00E5FF;
        --text-color: #E0F7FA;
        --accent-color: #004E55;
        --danger-color: #d32f2f;
        --danger-hover: #ff5252;
    }


    .dark-mode html,
    .dark-mode body {
        background: var(--bg-gradient);
        color: var(--text-color);
    }

    .dark-mode .container {
        background-color: var(--container-bg);
        /* box-shadow: 0 8px 20px rgba(0, 78, 85, 0.6); */
    }

    /* Headings */
    .dark-mode h2 {
        color: var(--primary-color);
    }

    /* Buttons */
    .dark-mode .btn-success {
        background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
        border: none;
        box-shadow: 0 4px 12px var(--primary-color);
    }

    .btn-custom-active {
        background-color: #007B82;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
    }

    .btn-custom-deactive {
        background-color: #A1A1A1;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
    }

    .btn-custom-active:hover {
        background-color: #006066;
    }

    .btn-custom-deactive:hover {
        background-color: #8f8f8f;
    }

    .btn-custom-active {
        background-color: #007B82;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
    }

    .btn-custom-deactive {
        background-color: #A1A1A1;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
    }

    .btn-custom-active:hover {
        background-color: #006066;
    }

    .btn-custom-deactive:hover {
        background-color: #8f8f8f;
    }

    
       .btn-success {
    background: linear-gradient(to left, #007B82, #001A1C) !important;
    color: #fff !important;
    border: none !important;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    box-shadow: 0 1px 4px 0 #00000033;
    transition: 0.3s ease;
}

.btn-success:hover {
    background: linear-gradient(to left, #006066, #000f10) !important;
}

/* Dropdown/Select Styling */
.form-select {
    background-color: transparent;
    border: 2px solid #00B8D4;
    color: #E0F7FA;
    border-radius: 8px;
    padding: 8px 12px;
    transition: all 0.3s ease;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2300B8D4' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 16px 12px;
}

.form-select:focus {
    border-color: #00E5FF;
    box-shadow: 0 0 8px rgba(0, 229, 255, 0.6);
    outline: none;
}

/* Dropdown options styling */
.form-select option {
    background-color: #003338;
    color: #E0F7FA;
    padding: 10px;
}



/* Selected option styling */
.form-select option:checked {
    /* background-color: #00B8D4; */
    color:white;
    /* font-weight: bold; */
}


    
</style>

<div class="container mt-4">
    <h2 class="mb-4">Access Management</h2>

    {% if messages %}
  {% for message in messages %}
    {% if 'user_action' in message.tags %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endif %}
  {% endfor %}
{% endif %}


    <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addUserModal">Add New User</button>

    <ul class="nav nav-tabs" id="accessTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="admins-tab" data-bs-toggle="tab" data-bs-target="#admins" type="button"
                role="tab">Admins</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="moderators-tab" data-bs-toggle="tab" data-bs-target="#moderators" type="button"
                role="tab">Moderators</button>
        </li>
    </ul>

    <div class="tab-content mt-3">
        <div class="tab-pane fade show active" id="admins" role="tabpanel">
            <table id="adminsTable" class="display table table-bordered">
                <thead>
                    <tr>
                        <th>S. No.</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Date Joined</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in admins %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.date_joined|date:"Y-m-d H:i" }}</td>
                        <td>
                            <form method="POST" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="toggle">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <button type="submit"
                                    class="btn btn-sm {% if user.is_active %}btn-custom-active{% else %}btn-custom-deactive{% endif %}">
                                    {% if user.is_active %}
                                    <i class="fa fa-ban"></i> Deactivate
                                    {% else %}
                                    <i class="fa fa-check"></i> Activate
                                    {% endif %}
                                </button>

                            </form>
                        </td>
                        <td>
                            <!-- Edit Button -->
                            <button class="btn btn-sm" data-bs-toggle="modal"
                                data-bs-target="#editUserModal{{ user.id }}">
                                <svg width="29" height="29" viewBox="0 0 29 29" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <rect width="28.2941" height="28.2941" rx="14.1471" fill="#007B82" />
                                    <path
                                        d="M16.8696 9.00124L19.4293 11.5609M15.1632 20.9461H21.9889M8.33758 17.5333L7.48438 20.9461L10.8972 20.0929L20.7824 10.2077C21.1023 9.88767 21.2821 9.45372 21.2821 9.00124C21.2821 8.54876 21.1023 8.1148 20.7824 7.7948L20.6357 7.64805C20.3157 7.32815 19.8817 7.14844 19.4293 7.14844C18.9768 7.14844 18.5428 7.32815 18.2228 7.64805L8.33758 17.5333Z"
                                        stroke="white" stroke-width="1.57515" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </button>

                            <!-- Delete Button -->
                            <button class="btn btn-sm" data-bs-toggle="modal"
                                data-bs-target="#deleteUserModal{{ user.id }}">
                                <svg width="29" height="29" viewBox="0 0 29 29" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <rect x="0.294922" y="0.292969" width="28.2941" height="28.2941" rx="14.1471"
                                        fill="#007B82" />
                                    <path
                                        d="M7.99034 9.33548L9.85472 20.5968C9.94 21.1123 10.2055 21.5808 10.604 21.9189C11.0025 22.2569 11.508 22.4425 12.0306 22.4426H14.9846M20.8945 9.33548L19.031 20.5968C18.9458 21.1123 18.6802 21.5808 18.2818 21.9189C17.8833 22.2569 17.3777 22.4425 16.8552 22.4426H13.9011M12.6976 13.6616V18.1165M16.1881 13.6616V18.1165M6.28125 9.33548H22.6045M16.8931 9.33548V7.76491C16.8931 7.4139 16.7537 7.07726 16.5055 6.82905C16.2573 6.58085 15.9206 6.44141 15.5696 6.44141H13.3161C12.9651 6.44141 12.6285 6.58085 12.3803 6.82905C12.1321 7.07726 11.9926 7.4139 11.9926 7.76491V9.33548H16.8931Z"
                                        stroke="white" stroke-width="1.32351" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </button>

                            <!-- Edit Modal -->
                            <div class="modal fade" id="editUserModal{{ user.id }}" tabindex="-1"
                                aria-labelledby="editUserLabel{{ user.id }}" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content"
                                        style="background: linear-gradient(to left, #006066, #000f10); color: white;">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="editUserLabel{{ user.id }}">Edit {{ user.username }}</h5>
                                            <button type="button" class="btn-close btn-close-white"
                                                data-bs-dismiss="modal"></button>
                                        </div>
                                        <form method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="edit">
                                            <input type="hidden" name="user_id" value="{{ user.id }}">
                                            <div class="modal-body">
                                                <div class="mb-3">
                                                    <label class="form-label">Username</label>
                                                    <input type="text" class="form-control" name="username"
                                                        value="{{ user.username }}" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Email</label>
                                                    <input type="email" class="form-control" name="email"
                                                        value="{{ user.email }}" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Role</label>
                                                    <select class="form-select" name="role" required>
    <option value="Admin" {% if user.is_superuser %}selected{% endif %}>Admin</option>
    <option value="Moderator" {% if not user.is_superuser %}selected{% endif %}>Moderator</option>
</select>

                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="reset" class="btn btn-outline-light"
                                                    data-bs-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-dark">Update</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Delete Modal -->
                            <div class="modal fade" id="deleteUserModal{{ user.id }}" tabindex="-1"
                                aria-labelledby="deleteUserLabel{{ user.id }}" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content"
                                        style="background: linear-gradient(to left, #007B82, #001A1C); color: white;">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="deleteUserLabel{{ user.id }}">Delete {{ user.username }}</h5>
                                            <button type="button" class="btn-close btn-close-white"
                                                data-bs-dismiss="modal"></button>
                                        </div>
                                        <form method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="delete">
                                            <input type="hidden" name="user_id" value="{{ user.id }}">
                                            <div class="modal-body">
                                                <p>Are you sure you want to delete <strong>{{ user.username }}</strong>?
                                                </p>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-outline-light"
                                                    data-bs-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-dark">Delete</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="tab-pane fade " id="moderators" role="tabpanel">
            <table id="moderatorsTable" class="display table table-bordered">
                <thead>
                    <tr>
                        <th>S. No.</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Date Joined</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in moderators %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.date_joined|date:"Y-m-d H:i" }}</td>
                       <td>
                            <form method="POST" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="toggle">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <button type="submit"
                                    class="btn btn-sm {% if user.is_active %}btn-custom-active{% else %}btn-custom-deactive{% endif %}">
                                    {% if user.is_active %}
                                    <i class="fa fa-ban"></i> Deactivate
                                    {% else %}
                                    <i class="fa fa-check"></i> Activate
                                    {% endif %}
                                </button>

                            </form>
                        </td>
                        <td>
                            <!-- Edit Button -->
                            <button class="btn btn-sm" data-bs-toggle="modal"
                                data-bs-target="#editModeratorModal{{ user.id }}">
                                <svg width="29" height="29" viewBox="0 0 29 29" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <rect width="28.2941" height="28.2941" rx="14.1471" fill="#007B82" />
                                    <path
                                        d="M16.8696 9.00124L19.4293 11.5609M15.1632 20.9461H21.9889M8.33758 17.5333L7.48438 20.9461L10.8972 20.0929L20.7824 10.2077C21.1023 9.88767 21.2821 9.45372 21.2821 9.00124C21.2821 8.54876 21.1023 8.1148 20.7824 7.7948L20.6357 7.64805C20.3157 7.32815 19.8817 7.14844 19.4293 7.14844C18.9768 7.14844 18.5428 7.32815 18.2228 7.64805L8.33758 17.5333Z"
                                        stroke="white" stroke-width="1.57515" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </button>

                            <!-- Delete Button -->
                            <button class="btn btn-sm" data-bs-toggle="modal"
                                data-bs-target="#deleteModeratorModal{{ user.id }}">
                                <svg width="29" height="29" viewBox="0 0 29 29" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <rect x="0.294922" y="0.292969" width="28.2941" height="28.2941" rx="14.1471"
                                        fill="#007B82" />
                                    <path
                                        d="M7.99034 9.33548L9.85472 20.5968C9.94 21.1123 10.2055 21.5808 10.604 21.9189C11.0025 22.2569 11.508 22.4425 12.0306 22.4426H14.9846M20.8945 9.33548L19.031 20.5968C18.9458 21.1123 18.6802 21.5808 18.2818 21.9189C17.8833 22.2569 17.3777 22.4425 16.8552 22.4426H13.9011M12.6976 13.6616V18.1165M16.1881 13.6616V18.1165M6.28125 9.33548H22.6045M16.8931 9.33548V7.76491C16.8931 7.4139 16.7537 7.07726 16.5055 6.82905C16.2573 6.58085 15.9206 6.44141 15.5696 6.44141H13.3161C12.9651 6.44141 12.6285 6.58085 12.3803 6.82905C12.1321 7.07726 11.9926 7.4139 11.9926 7.76491V9.33548H16.8931Z"
                                        stroke="white" stroke-width="1.32351" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </button>

                            <!-- Edit Modal -->
                            <div class="modal fade" id="editModeratorModal{{ user.id }}" tabindex="-1"
                                aria-labelledby="editUserLabel{{ user.id }}" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content"
                                        style="background: linear-gradient(to left, #006066, #000f10); color: white;">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="editUserLabel{{ user.id }}">Edit {{ user.username }}</h5>
                                            <button type="button" class="btn-close btn-close-white"
                                                data-bs-dismiss="modal"></button>
                                        </div>
                                        <form method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="edit">
                                            <input type="hidden" name="user_id" value="{{ user.id }}">
                                            <div class="modal-body">
                                                <div class="mb-3">
                                                    <label class="form-label">Username</label>
                                                    <input type="text" class="form-control" name="username"
                                                        value="{{ user.username }}" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Email</label>
                                                    <input type="email" class="form-control" name="email"
                                                        value="{{ user.email }}" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Role</label>
                                                    <select class="form-select" name="role" required>
    <option value="Admin" {% if user.is_superuser %}selected{% endif %}>Admin</option>
    <option value="Moderator" {% if not user.is_superuser %}selected{% endif %}>Moderator</option>
</select>

                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="reset" class="btn btn-outline-light"
                                                    data-bs-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-dark">Update</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Delete Modal -->
                            <div class="modal fade" id="deleteModeratorModal{{ user.id }}" tabindex="-1"
                                aria-labelledby="deleteUserLabel{{ user.id }}" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content"
                                        style="background: linear-gradient(to left, #006066, #000f10); color: white;">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="deleteUserLabel{{ user.id }}">Delete {{ user.username }}</h5>
                                            <button type="button" class="btn-close btn-close-white"
                                                data-bs-dismiss="modal"></button>
                                        </div>
                                        <form method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="delete">
                                            <input type="hidden" name="user_id" value="{{ user.id }}">
                                            <div class="modal-body">
                                                <p>Are you sure you want to delete <strong>{{ user.username }}</strong>?
                                                </p>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-outline-light"
                                                    data-bs-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-dark">Delete</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog">
        <form method="POST" class="modal-content">
            {% csrf_token %}
            <input type="hidden" name="action" value="add">
            <div class="modal-header">
                <h5 class="modal-title">Add New User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="text" name="username" class="form-control mb-2" placeholder="Username" required>
                <input type="email" name="email" class="form-control mb-2" placeholder="Email" required>
                <input type="password" name="password" class="form-control mb-2" placeholder="Password" required>
                <select name="role" class="form-select" required>
                    <option value="" disabled selected>Select Role</option>
                    <option value="Admin">Admin</option>
                    <option value="Moderator">Moderator</option>
                </select>
            </div>
            <div class="modal-footer">
                 <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-success">Add User</button>
            </div>
        </form>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#adminsTable').DataTable();

        $('#moderatorsTable').DataTable();
    });
</script>


{% endblock %}